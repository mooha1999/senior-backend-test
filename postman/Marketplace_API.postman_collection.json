{
  "info": {
    "name": "Marketplace API",
    "description": "Full end-to-end flows for the event-driven marketplace backend.\n\nCovers login, order creation, and order viewing across all three roles (admin, brand, customer), plus error scenarios.\n\n## How to use\n1. Import this collection into Postman\n2. Make sure the server is running (`npm start`)\n3. Run folders in order, or use the Collection Runner for full flows\n4. Tokens are auto-extracted from login responses and chained into subsequent requests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "customerToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "customer2Token",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "brandToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "brand2Token",
      "value": "",
      "type": "string"
    },
    {
      "key": "orderId",
      "value": "",
      "type": "string"
    },
    {
      "key": "orderId2",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Body has status ok', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.status).to.eql('ok');",
                  "    pm.expect(json.timestamp).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            },
            "description": "Verify the server is running."
          }
        }
      ],
      "description": "Basic connectivity check."
    },
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "Login as Customer 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Returns token and user', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.token).to.be.a('string');",
                  "    pm.expect(json.user.role).to.eql('customer');",
                  "    pm.expect(json.user.email).to.eql('customer@marketplace.com');",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('customerToken', json.token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"customer@marketplace.com\",\n  \"password\": \"customer123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Customer 1. The JWT token is automatically saved to `customerToken`."
          }
        },
        {
          "name": "Login as Customer 2",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('customer2Token', json.token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"customer2@marketplace.com\",\n  \"password\": \"customer456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Customer 2. Token saved to `customer2Token`."
          }
        },
        {
          "name": "Login as Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Role is admin', function () {",
                  "    pm.expect(pm.response.json().user.role).to.eql('admin');",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('adminToken', json.token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@marketplace.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Admin. Token saved to `adminToken`."
          }
        },
        {
          "name": "Login as Brand 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Role is brand', function () {",
                  "    pm.expect(pm.response.json().user.role).to.eql('brand');",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('brandToken', json.token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"brand@marketplace.com\",\n  \"password\": \"brand123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Brand 1 (brandId: brand1). Token saved to `brandToken`."
          }
        },
        {
          "name": "Login as Brand 2",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('brand2Token', json.token);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"brand2@marketplace.com\",\n  \"password\": \"brand456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Brand 2 (brandId: brand2). Token saved to `brand2Token`."
          }
        }
      ],
      "description": "Login with all available roles. Tokens are automatically extracted and stored in collection variables for use in subsequent requests."
    },
    {
      "name": "2. Auth Error Scenarios",
      "item": [
        {
          "name": "Login with invalid credentials",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "pm.test('Returns error message', function () {",
                  "    pm.expect(pm.response.json().error).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"customer@marketplace.com\",\n  \"password\": \"wrongpassword\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Attempt login with wrong password. Expects 401."
          }
        },
        {
          "name": "Login with missing fields",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('Returns validation error', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.error).to.include('Validation');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"customer@marketplace.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Attempt login with missing password field. Expects 400 validation error."
          }
        },
        {
          "name": "Login with nonexistent user",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nobody@marketplace.com\",\n  \"password\": \"password\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Attempt login with an email that doesn't exist. Expects 401."
          }
        }
      ],
      "description": "Negative authentication scenarios: wrong password, missing fields, nonexistent user."
    },
    {
      "name": "3. Customer Flow — Create & View Orders",
      "item": [
        {
          "name": "Customer 1: Create order with brand1 products",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "pm.test('Order is PENDING', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.status).to.eql('PENDING');",
                  "    pm.expect(json.items).to.have.lengthOf(2);",
                  "    pm.expect(json.id).to.be.a('string');",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('orderId', json.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"productId\": \"brand1-product-abc\", \"quantity\": 2 },\n    { \"productId\": \"brand1-product-xyz\", \"quantity\": 1 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Customer 1 creates an order with brand1 products. Order ID is saved to `orderId`. Triggers the event chain: payment → stock → delivery."
          }
        },
        {
          "name": "Customer 1: Create order with brand2 products",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.collectionVariables.set('orderId2', json.id);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"productId\": \"brand2-product-def\", \"quantity\": 3 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Customer 1 creates a second order with brand2 products. Order ID saved to `orderId2`."
          }
        },
        {
          "name": "Customer 1: View own orders (sees both)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Returns array of own orders', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json).to.be.an('array');",
                  "    pm.expect(json.length).to.be.at.least(2);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Customer 1 lists orders — should see both orders they created."
          }
        },
        {
          "name": "Customer 1: View order by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Returns the correct order', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.id).to.eql(pm.collectionVariables.get('orderId'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}"]
            },
            "description": "Customer 1 retrieves a specific order by ID."
          }
        },
        {
          "name": "Customer 2: View orders (sees none — not their orders)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Returns empty array (no orders for this customer)', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json).to.be.an('array');",
                  "    pm.expect(json.length).to.eql(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{customer2Token}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Customer 2 lists orders — should see an empty array since they haven't placed any orders."
          }
        },
        {
          "name": "Customer 2: View Customer 1's order by ID (404 — access denied)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "pm.test('Access denied for other customer order', function () {",
                  "    pm.expect(pm.response.json().error).to.include('not found');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{customer2Token}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}"]
            },
            "description": "Customer 2 tries to access Customer 1's order — should get 404 (access denied is surfaced as not found)."
          }
        }
      ],
      "description": "Full customer flow: create orders with different brand products, view own orders, verify cross-customer isolation."
    },
    {
      "name": "4. Admin Flow — View All Orders",
      "item": [
        {
          "name": "Admin: View all orders",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Admin sees all orders', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json).to.be.an('array');",
                  "    pm.expect(json.length).to.be.at.least(2);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Admin lists all orders — should see every order in the system regardless of customer."
          }
        },
        {
          "name": "Admin: View specific order by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Admin can access any order', function () {",
                  "    pm.expect(pm.response.json().id).to.eql(pm.collectionVariables.get('orderId'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}"]
            },
            "description": "Admin retrieves a specific order — admin can access any order."
          }
        }
      ],
      "description": "Admin flow: verify admin can see all orders and access any order by ID."
    },
    {
      "name": "5. Brand Flow — View Brand-Specific Orders",
      "item": [
        {
          "name": "Brand 1: View orders (sees only brand1 product orders)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Brand 1 sees only orders with brand1 products', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json).to.be.an('array');",
                  "    json.forEach(function(order) {",
                  "        var hasBrand1Product = order.items.some(function(item) {",
                  "            return item.productId.startsWith('brand1');",
                  "        });",
                  "        pm.expect(hasBrand1Product).to.be.true;",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{brandToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Brand 1 lists orders — should only see orders containing brand1 products."
          }
        },
        {
          "name": "Brand 1: View brand1 order by ID (allowed)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Can access order with brand1 products', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json.id).to.eql(pm.collectionVariables.get('orderId'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{brandToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId}}"]
            },
            "description": "Brand 1 views the order that contains brand1 products — should succeed."
          }
        },
        {
          "name": "Brand 1: View brand2 order by ID (404 — not their brand)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "pm.test('Cannot access order with only brand2 products', function () {",
                  "    pm.expect(pm.response.json().error).to.include('not found');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{brandToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders/{{orderId2}}",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "{{orderId2}}"]
            },
            "description": "Brand 1 tries to view an order that only contains brand2 products — should get 404."
          }
        },
        {
          "name": "Brand 2: View orders (sees only brand2 product orders)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "pm.test('Brand 2 sees only orders with brand2 products', function () {",
                  "    var json = pm.response.json();",
                  "    pm.expect(json).to.be.an('array');",
                  "    json.forEach(function(order) {",
                  "        var hasBrand2Product = order.items.some(function(item) {",
                  "            return item.productId.startsWith('brand2');",
                  "        });",
                  "        pm.expect(hasBrand2Product).to.be.true;",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{brand2Token}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Brand 2 lists orders — should only see orders containing brand2 products."
          }
        }
      ],
      "description": "Brand flow: verify brands only see orders containing their products, and cannot access other brands' orders."
    },
    {
      "name": "6. RBAC Error Scenarios",
      "item": [
        {
          "name": "Admin tries to create order (403 Forbidden)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403', function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{adminToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"productId\": \"brand1-product-abc\", \"quantity\": 1 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Admin tries to create an order — should be forbidden (only customers can create orders)."
          }
        },
        {
          "name": "Brand tries to create order (403 Forbidden)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 403', function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{brandToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"productId\": \"brand1-product-abc\", \"quantity\": 1 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Brand tries to create an order — should be forbidden."
          }
        },
        {
          "name": "Unauthenticated: Create order (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"productId\": \"brand1-product-abc\", \"quantity\": 1 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Request without Authorization header — should get 401."
          }
        },
        {
          "name": "Unauthenticated: View orders (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Request without Authorization header — should get 401."
          }
        },
        {
          "name": "Invalid token: View orders (401)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer invalid.jwt.token" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Request with a malformed JWT — should get 401."
          }
        }
      ],
      "description": "RBAC and authentication error scenarios: wrong role, no token, invalid token."
    },
    {
      "name": "7. Order Validation Errors",
      "item": [
        {
          "name": "Create order with empty items array",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "pm.test('Validation error returned', function () {",
                  "    pm.expect(pm.response.json().error).to.include('Validation');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Attempt to create an order with an empty items array — should fail validation."
          }
        },
        {
          "name": "Create order with invalid quantity (0)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"productId\": \"brand1-product-abc\", \"quantity\": 0 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Attempt to create an order with quantity 0 — should fail validation (minimum 1)."
          }
        },
        {
          "name": "Create order with missing productId",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 400', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    { \"quantity\": 2 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orders",
              "host": ["{{baseUrl}}"],
              "path": ["orders"]
            },
            "description": "Attempt to create an order with missing productId — should fail validation."
          }
        },
        {
          "name": "Get nonexistent order (404)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{customerToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/orders/00000000-0000-0000-0000-000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["orders", "00000000-0000-0000-0000-000000000000"]
            },
            "description": "Request an order with a UUID that doesn't exist — should get 404."
          }
        }
      ],
      "description": "Order validation edge cases: empty items, invalid quantities, missing fields, nonexistent orders."
    }
  ]
}
